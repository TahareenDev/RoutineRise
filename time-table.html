<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Time Table</title>
  <style>
    :root {
      --cell-height: 56px;
    }
    body {
      margin: 0; padding: 16px;
      font-family: Arial, sans-serif;
      background: #f5f8ff;
      color: #0b2545;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .nav-buttons {
      display: flex;
      gap: 8px;
    }
    button {
      padding: 8px 12px;
      border: 1px solid #aaa;
      background: #fff;
      border-radius: 6px;
      cursor: pointer;
    }
    .clock {
      font-weight: 700;
    }
    .container {
      display: flex;
      gap: 12px;
    }
    .time-col {
      display: none;
      width: 70px;
    }
    .grid-wrap {
      flex: 1;
      overflow: auto;
      border: 1px solid #ccc;
      background: #fff;
      border-radius: 8px;
      padding: 8px;
    }
    .week-grid {
      display: grid;
      grid-template-columns: 100px repeat(7, 1fr);
      min-width: calc(100px + 7 * 100px);
    }
    .head {
      position: sticky;
      top: 0;
      background: #e8efff;
      padding: 8px;
      font-weight: 600;
      border-bottom: 1px solid #bbb;
      text-align: center;
    }
    .slot {
      min-height: var(--cell-height);
      border-bottom: 1px dashed #ddd;
      padding: 4px;
      box-sizing: border-box;
    }
    .day-col {
      border-left: 1px solid #ddd;
    }
    .cell {
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .cell.empty {
      color: #999;
    }
    .today {
      background: #eef8ff;
    }
    .modal, .modal-time {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: 0.2s;
    }
    .modal.show, .modal-time.show {
      opacity: 1;
      pointer-events: auto;
    }
    .modal-card, .modal-time-card {
      background: #fff;
      padding: 16px;
      border-radius: 8px;
      max-width: 400px;
      width: 100%;
    }
    input, textarea, select {
      width: 100%;
      padding: 8px;
      border: 1px solid #aaa;
      border-radius: 6px;
      box-sizing: border-box;
    }
    .time-inputs {
      display: flex;
      gap: 8px;
    }
    .time-inputs input {
      flex: 1;
    }
    .time-display {
      font-weight: bold;
      font-size: 14px;
    }
.fullscreen-btn {
  position: fixed;
  bottom: 20px;       
  right: 20px;        
  padding: 8px 12px;
  background: rgba(0, 0, 0, 0.4);
  border: 1px solid white;
  border-radius: 4px;
  color: white;
  cursor: pointer;
  font-size: 14px;
  z-index: 1000;
  transition: background 0.3s;
}

.fullscreen-btn:hover {
  background: rgba(0, 0, 0, 0.6);
}


    .fullscreen-btn:hover {
      background: rgba(0, 0, 0, 0.6);
    }
  </style>
</head>
<body>
  <header>
    <div class="nav-buttons">
      <button id="prevWeek">« Prev Week</button>
      <button id="nextWeek">Next Week »</button>
    </div>
    <div class="clock" id="clock">--:--:--</div>
  </header>

  <div class="container">
    <div class="time-col" aria-hidden="true"></div>
    <div class="grid-wrap">
      <div class="week-grid" id="timetableGrid"></div>
    </div>
  </div>

  <div class="modal" id="modal">
    <div class="modal-card">
      <h3 id="modalTitle">Edit</h3>
      <div>
        <input id="eventTitle" placeholder="Title" />
      </div>
      <div style="margin-top:8px;">
        <textarea id="eventNote" rows="3" placeholder="Note / location"></textarea>
      </div>
      <div style="margin-top:8px;">
        <select id="eventColor">
          <option value="">Default</option>
          <option value="#ffd1a9">Peach</option>
          <option value="#c7f3ff">Sky</option>
          <option value="#d7ffd9">Mint</option>
        </select>
      </div>
      <div style="margin-top:12px; display:flex; justify-content:flex-end; gap:8px;">
        <button id="btnDelete">Delete</button>
        <button id="btnCancel">Cancel</button>
        <button id="btnSave">Save</button>
      </div>
    </div>
  </div>

  <div class="modal-time" id="modalTime">
    <div class="modal-time-card">
      <h3 id="modalTimeTitle">Set Time</h3>
      <div class="time-inputs">
        <div>
          <label for="timeFrom">From:</label>
          <input id="timeFrom" type="time" />
        </div>
        <div>
          <label for="timeTo">To:</label>
          <input id="timeTo" type="time" />
        </div>
      </div>
      <div style="margin-top:12px; display:flex; justify-content:flex-end; gap:8px;">
        <button id="btnTimeCancel">Cancel</button>
        <button id="btnTimeSave">Save</button>
      </div>
    </div>
  </div>
    <button class="fullscreen-btn" id="fsBtn">Fullscreen</button>


  <script>
    const START_ROW_COUNT = 8;
    const STORAGE_KEY = 'timetableEventsFull';
    const STORAGE_TIME_KEY = 'timetableRowTimes';

    const clockEl = document.getElementById('clock');
    const prevWeekBtn = document.getElementById('prevWeek');
    const nextWeekBtn = document.getElementById('nextWeek');
    const gridEl = document.getElementById('timetableGrid');

    const modal = document.getElementById('modal');
    const eventTitle = document.getElementById('eventTitle');
    const eventNote = document.getElementById('eventNote');
    const eventColor = document.getElementById('eventColor');
    const btnSave = document.getElementById('btnSave');
    const btnCancel = document.getElementById('btnCancel');
    const btnDelete = document.getElementById('btnDelete');
    const modalTitle = document.getElementById('modalTitle');

    const modalTime = document.getElementById('modalTime');
    const modalTimeTitle = document.getElementById('modalTimeTitle');
    const timeFromInput = document.getElementById('timeFrom');
    const timeToInput = document.getElementById('timeTo');
    const btnTimeSave = document.getElementById('btnTimeSave');
    const btnTimeCancel = document.getElementById('btnTimeCancel');

    let events = loadEvents();
    let rowTimes = loadRowTimes();
    let visibleWeekStart = getStartOfWeek(new Date());
    let editing = null;
    let editingTime = null;

    function getStartOfWeek(date) {
      const d = new Date(date);
      const day = d.getDay();
      d.setDate(d.getDate() - day);
      d.setHours(0,0,0,0);
      return d;
    }
    function addDays(date, n) {
      const d = new Date(date);
      d.setDate(d.getDate() + n);
      return d;
    }
    function formatDate(d) {
      return d.toISOString().slice(0,10);
    }

    function loadEvents() {
      try {
        return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
      } catch (e) {
        return {};
      }
    }
    function saveEvents() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(events));
    }

    function loadRowTimes() {
      try {
        return JSON.parse(localStorage.getItem(STORAGE_TIME_KEY)) || {};
      } catch (e) {
        return {};
      }
    }
    function saveRowTimes() {
      localStorage.setItem(STORAGE_TIME_KEY, JSON.stringify(rowTimes));
    }

    function to12Hour(time24) {
      if (!time24) return '';
      const [hStr, mStr] = time24.split(':');
      let h = parseInt(hStr, 10);
      const m = mStr;
      const ampm = h >= 12 ? 'PM' : 'AM';
      h = h % 12;
      if (h === 0) h = 12;
      return `${h}:${m} ${ampm}`;
    }

    function buildGrid() {
      gridEl.innerHTML = '';

      // Header
      const headSet = document.createElement('div');
      headSet.className = 'head';
      headSet.textContent = 'Set Time';
      gridEl.appendChild(headSet);
      for (let i = 0; i < 7; i++) {
        const d = addDays(visibleWeekStart, i);
        const hd = document.createElement('div');
        hd.className = 'head';
        const dayName = d.toLocaleString(undefined, { weekday: 'short' });
        const datePart = d.toLocaleString(undefined, { month: 'short', day: 'numeric' });
        hd.innerHTML = `<div>${dayName}</div><div style="font-size:12px">${datePart}</div>`;
        gridEl.appendChild(hd);
      }

      for (let r = 0; r < START_ROW_COUNT; r++) {
        addRowCells(r);
      }

      const addRowDiv = document.createElement('div');
      addRowDiv.className = 'slot';
      addRowDiv.style.gridColumn = '1 / span 8';
      addRowDiv.style.textAlign = 'center';
      addRowDiv.style.borderBottom = 'none';
      addRowDiv.innerHTML = `<button id="addRowBtn" style="padding:6px 12px;border:1px solid #aaa;border-radius:6px;background:#e8efff;cursor:pointer;">+ Add Row</button>`;
      gridEl.appendChild(addRowDiv);

      document.getElementById('addRowBtn').addEventListener('click', () => {
        const current = countDataRows();
        addRowCells(current);
        gridEl.appendChild(addRowDiv);
      });
    }

    function countDataRows() {
      const rows = new Set();
      gridEl.querySelectorAll('.cell').forEach(c => {
        if (c.dataset.row != null) {
          rows.add(c.dataset.row);
        }
      });
      return rows.size;
    }

    function addRowCells(rowIndex) {
      const slotFirst = document.createElement('div');
      slotFirst.className = 'slot day-col';
      const cellFirst = document.createElement('div');
      cellFirst.className = 'cell empty';
      cellFirst.dataset.row = rowIndex;
      cellFirst.dataset.isTimeCell = 'true';
      cellFirst.innerHTML = `<small>Double click to add</small>`;
      cellFirst.addEventListener('dblclick', () => openTimeEditor(rowIndex));
      slotFirst.appendChild(cellFirst);
      gridEl.appendChild(slotFirst);

      for (let i = 0; i < 7; i++) {
        const wrap = document.createElement('div');
        wrap.className = 'slot day-col';
        const cell = document.createElement('div');
        cell.className = 'cell empty';
        const d = addDays(visibleWeekStart, i);
        cell.dataset.date = formatDate(d);
        cell.dataset.row = rowIndex;
        cell.addEventListener('dblclick', () => openEditor(d, rowIndex));
        cell.innerHTML = `<small>Double click to add</small>`;
        wrap.appendChild(cell);
        gridEl.appendChild(wrap);
      }
    }

    function renderGrid() {
      document.querySelectorAll('.cell').forEach(cell => {
        const isTimeCell = cell.dataset.isTimeCell === 'true';
        if (isTimeCell) {
          const row = cell.dataset.row;
          const tm = rowTimes[row];
          if (tm && tm.from && tm.to) {
            cell.classList.remove('empty');
            cell.innerHTML = `<span class="time-display">${to12Hour(tm.from)} — ${to12Hour(tm.to)}</span>`;
          } else {
            cell.classList.add('empty');
            cell.innerHTML = `<small>Double click to add</small>`;
          }
        } else {
          const key = `${cell.dataset.date} ${cell.dataset.row}`;
          const ev = events[key];
          if (ev) {
            cell.classList.remove('empty');
            cell.innerHTML = `<div style="font-weight:600">${escapeHtml(ev.title)}</div>
                              <div style="font-size:12px;color:#556">${escapeHtml(ev.note || '')}</div>`;
            if (ev.color) cell.style.background = ev.color;
            else cell.style.background = '';
          } else {
            cell.classList.add('empty');
            cell.innerHTML = `<small>Double click to add</small>`;
            cell.style.background = '';
          }
        }
      });
      highlightToday();
    }

    function escapeHtml(s) {
      return String(s).replace(/[&<>"']/g, c => {
        return ({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c] || c);
      });
    }

    function highlightToday() {
      const now = new Date();
      const todayStr = formatDate(now);
      document.querySelectorAll('.cell').forEach(cell => {
        if (cell.dataset.date === todayStr) {
          cell.classList.add('today');
        } else {
          cell.classList.remove('today');
        }
      });
    }

    function openEditor(dateObj, rowIndex) {
      editing = { date: dateObj, row: rowIndex };
      modal.classList.add('show');
      const key = `${formatDate(dateObj)} ${rowIndex}`;
      const ev = events[key] || {};
      eventTitle.value = ev.title || '';
      eventNote.value = ev.note || '';
      eventColor.value = ev.color || '';
      modalTitle.textContent = `Edit — ${dateObj.toDateString()} (Row ${rowIndex + 1})`;
    }
    function closeEditor() {
      editing = null;
      modal.classList.remove('show');
    }

    btnSave.addEventListener('click', () => {
      if (!editing) return;
      const { date, row } = editing;
      const key = `${formatDate(date)} ${row}`;
      const title = eventTitle.value.trim();
      if (!title) {
        delete events[key];
      } else {
        events[key] = {
          title,
          note: eventNote.value.trim(),
          color: eventColor.value || ''
        };
      }
      saveEvents();
      renderGrid();
      closeEditor();
    });
    btnCancel.addEventListener('click', closeEditor);
    btnDelete.addEventListener('click', () => {
      if (!editing) return;
      const { date, row } = editing;
      const key = `${formatDate(date)} ${row}`;
      delete events[key];
      saveEvents();
      renderGrid();
      closeEditor();
    });

    function openTimeEditor(rowIndex) {
      editingTime = rowIndex;
      modalTime.classList.add('show');
      const tm = rowTimes[rowIndex] || {};
      timeFromInput.value = tm.from || '';
      timeToInput.value = tm.to || '';
      modalTimeTitle.textContent = `Set Time for Row ${rowIndex + 1}`;
    }
    function closeTimeEditor() {
      editingTime = null;
      modalTime.classList.remove('show');
    }

    btnTimeSave.addEventListener('click', () => {
      if (editingTime == null) return;
      const from = timeFromInput.value;
      const to = timeToInput.value;
      if (from && to) {
        rowTimes[editingTime] = { from, to };
      } else {
        delete rowTimes[editingTime];
      }
      saveRowTimes();
      renderGrid();
      closeTimeEditor();
    });
    btnTimeCancel.addEventListener('click', closeTimeEditor);

    prevWeekBtn.addEventListener('click', () => {
      visibleWeekStart = addDays(visibleWeekStart, -7);
      buildGrid();
      renderGrid();
    });
    nextWeekBtn.addEventListener('click', () => {
      visibleWeekStart = addDays(visibleWeekStart, +7);
      buildGrid();
      renderGrid();
    });

    function updateClock() {
      const now = new Date();
      clockEl.textContent = now.toLocaleString(undefined, {
        weekday: 'short', month: 'short', day: 'numeric',
        hour: '2-digit', minute: '2-digit', second: '2-digit'
      });
    }

    buildGrid();
    renderGrid();
    updateClock();
    setInterval(updateClock, 1000);

    document.addEventListener('keydown', e => {
      if (e.key === 'Escape') {
        closeEditor();
        closeTimeEditor();
      }
    });
    
    const fsBtn = document.getElementById("fsBtn");

    fsBtn.addEventListener("click", () => {
      if (!document.fullscreenElement && !document.webkitFullscreenElement && !document.msFullscreenElement) {
        if (document.documentElement.requestFullscreen) {
          document.documentElement.requestFullscreen();
        } else if (document.documentElement.webkitRequestFullscreen) {
          document.documentElement.webkitRequestFullscreen();
        } else if (document.documentElement.msRequestFullscreen) {
          document.documentElement.msRequestFullscreen();
        }
        fsBtn.textContent = "Exit";
      } else {
        if (document.exitFullscreen) {
          document.exitFullscreen();
        } else if (document.webkitExitFullscreen) {
          document.webkitExitFullscreen();
        } else if (document.msExitFullscreen) {
          document.msExitFullscreen();
        }
        fsBtn.textContent = "Fullscreen";
      }
    });

    document.addEventListener("fullscreenchange", () => {
      if (document.fullscreenElement) {
        fsBtn.textContent = "Exit";
      } else {
        fsBtn.textContent = "Fullscreen";
      }
    });
    document.addEventListener("webkitfullscreenchange", () => {
      if (document.webkitFullscreenElement) {
        fsBtn.textContent = "Exit";
      } else {
        fsBtn.textContent = "Fullscreen";
      }
    });
    document.addEventListener("msfullscreenchange", () => {
      if (document.msFullscreenElement) {
        fsBtn.textContent = "Exit";
      } else {
        fsBtn.textContent = "Fullscreen";
      }
    });
  </script>
</body>
</html>
